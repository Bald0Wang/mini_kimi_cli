# 06. 俯瞰：地图全览 (Modular Learning)

> "不识庐山真面目，只缘身在此山中。" —— 苏轼

当我们深入细节时，容易迷失方向。现在，让我们跳出代码的丛林，站在高处俯瞰 Mini Kimi 的全貌。这章我们将梳理各个模块之间的关系，建立一张清晰的“全局地图”。这不仅有助于你理解当前的代码，更能为你未来的扩展指明方向。

### 知识加油站 ⛽️

#### 1. 关注点分离 (Separation of Concerns, SoC)
这是软件工程中最核心的原则之一。它要求我们将计算机程序分隔为不同部分，每一部分解决一个单独的关注点。在 Mini Kimi 中，LLM 层只管通信，UI 层只管显示，Soul 层只管逻辑，Tools 层只管执行。这种设计使得系统易于维护和扩展。
*   **参考阅读**: [Separation of Concerns - Wikipedia](https://en.wikipedia.org/wiki/Separation_of_concerns)

#### 2. 高内聚低耦合 (High Cohesion, Low Coupling)
模块化设计的终极目标。
*   **高内聚**: 模块内部的元素紧密相关，共同完成一个单一任务。
*   **低耦合**: 模块之间的依赖关系尽可能少，互不影响。

---

### 学习目标

- 把“Agent 是什么”落实到具体目录结构上
- 形成稳定的阅读顺序：入口 → 核心循环 → 模型调用 → 工具执行
- 为后续扩展（安全、上下文压缩、多 Agent）打基础

---

### 模块 0：全局地图

**必读**

- `mini_kimi/docs/结构说明.md`

**检查点**

- 能说清楚：每一层的职责边界（UI 只负责交互、Soul 负责循环、LLM 负责模型调用、Tools 负责执行能力）

**建议你做一次“定位练习”**

- 现象：`ModuleNotFoundError`
- 你应该第一时间想到：这是 **UI 入口与导入路径** 的问题，而不是 LLM/Tools 的问题

---

### 模块 1：LLM（模型调用与工具调用协议）

**必读**

- `mini_kimi/src/mini_kimi/llm/client.py`

**检查点**

- 能说清楚：工具 schema 传给模型后，模型如何返回 tool_calls

**关键数据结构**

- 输入：`messages`（对话历史）+ `tools`（schema 列表）
- 输出：`message.content` 或 `message.tool_calls`

---

### 模块 2：Soul（ReAct 循环）

**必读**

- `mini_kimi/src/mini_kimi/soul/soul.py`

**检查点**

- 能画出“messages 增长图”（一次 tool call 会增加哪些消息）

**建议你画的最小“增长图”**

- user 输入 +1
- assistant（带 tool_calls）+1
- tool（工具结果）+1
- assistant（最终回答）+1

---

### 模块 3：Tools（能力与边界）

**必读**

- `mini_kimi/src/mini_kimi/tools/bash/bash_tool.py`
- `mini_kimi/src/mini_kimi/tools/file/write_tool.py`
- `mini_kimi/src/mini_kimi/tools/web/search_tool.py`

**检查点**

- 能说清楚：工具的 schema 与 __call__ 分别解决什么问题

**工程提醒**

- schema 要“可读”：描述越清晰，模型越容易正确调用
- 输出要“可控”：工具结果要截断、要去噪、避免把大段 HTML 直接塞回上下文
