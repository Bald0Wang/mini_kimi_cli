# 01. 启程：点燃引擎 (Environment & Setup)

> "千里之行，始于足下。但对于程序员来说，千里之行，始于配置环境。" —— 佚名

欢迎来到 Mini Kimi 的世界。在这里，你不再只是一个“使用者”，而是一个“创造者”。启动这个程序，不仅仅是运行一行代码，更是点燃了一个微型智能引擎。当终端亮起绿色的 `User>` 提示符时，你正在与一个由数千亿参数构成的数字大脑建立连接。

在开始之前，让我们先了解一些必要的背景知识，这能让你走得更稳。

### 知识加油站 ⛽️

#### 1. Python 虚拟环境 (Virtual Environments)
想象一下，如果你的厨房里只有一套刀具，既要切生肉，又要切水果，甚至还要修剪花园，那该多混乱？虚拟环境就是为每个项目准备的“独立厨房”。它允许你在同一台机器上为不同项目安装不同版本的库，互不干扰。
*   **核心命令**: `python -m venv .venv` (创建), `source .venv/bin/activate` (激活/Linux), `.venv\Scripts\activate` (激活/Windows)
*   **参考阅读**: [Python 官方文档 - 虚拟环境](https://docs.python.org/3/tutorial/venv.html)

#### 2. 环境变量 (Environment Variables)
如果说代码是机器的“肉体”，环境变量就是机器的“潜意识”。它们是操作系统级别的键值对，用于告诉程序一些配置信息（如 API Key），而不需要把这些敏感信息硬编码在代码里。这是一种安全且灵活的配置方式。

---

### 学习目标

- 在 Windows（PowerShell）上**成功启动** Mini Kimi，并完成一次对话
- 能区分“**程序能跑**”与“**工具可用**”两种验收标准
- 知道遇到报错时该先排查什么（依赖、API Key、PYTHONPATH）

---

### 前置条件

- Python 3.10+
- 可联网（SearchWeb / FetchURL 需要）
- Moonshot API Key（环境变量 `MOONSHOT_API_KEY`）
- 推荐：使用虚拟环境（venv）隔离依赖，避免与其他项目冲突

---

### 最短成功路径（3~5 步）

1) 安装依赖：

```bash
pip install openai ddgs
```

2) 设置环境变量（PowerShell）：

```powershell
$env:MOONSHOT_API_KEY="your_key"
```

3) 从项目根目录运行（推荐）：

```powershell
$env:PYTHONPATH="mini_kimi/src"
python mini_kimi/src/mini_kimi/ui/shell/main.py
```

4) 在 CLI 中输入：

- `你好，介绍一下你自己`

**预期**：看到 Kimi 的回答文本（不是报错）。

---

### 关键文件（本阶段只需要知道它们存在）

- `mini_kimi/src/mini_kimi/ui/shell/main.py`：REPL 入口
- `mini_kimi/src/mini_kimi/soul/soul.py`：ReAct 循环
- `mini_kimi/src/mini_kimi/llm/client.py`：模型调用与 API Key 获取

---

### 检查点（完成标准）

- **Checkpoint A（能跑）**：能正常进入 CLI 并得到一次回答
- **Checkpoint B（工具能用）**：至少成功一次调用工具（例如搜索或写文件）

建议用下面两条任务验证：

1) **验证 WriteFile**：

- 输入：`把“Hello World”写入 hello.txt`
- 预期：终端出现 `WriteFile` 的工具调用日志，并提示写入成功

2) **验证 SearchWeb**：

- 输入：`搜索 Python 3.13 release highlights`
- 预期：终端出现 `SearchWeb` 的工具调用日志，并返回若干条结果

---

### 验证方式（命令 + 预期现象）

**启动命令（PowerShell）**：

```powershell
$env:PYTHONPATH="mini_kimi/src"
python mini_kimi/src/mini_kimi/ui/shell/main.py
```

**预期现象**

- 启动后看到欢迎语（REPL 已进入）
- 每次输入后，先出现类似 `Thinking...` 的提示
- 若模型选择调用工具，会看到类似 `Tool Call` 的日志行

---

### 观测信号（Signals）

- **程序能跑（最小成功）**：你能输入一句话并得到模型回答
- **工具可用（进阶成功）**：你能看到至少一次 `Tool Call`，且紧接着出现 `Tool Result`
- **模型没用工具并不代表失败**：有些问题模型会直接回答；你要用“明确要求调用工具”的提示词验证

---

### 常见坑与排错（本阶段高频）

#### 1) `ModuleNotFoundError: No module named 'mini_kimi'`

- **原因**：运行目录/导入路径导致 Python 找不到包根目录
- **解决**：按“最短成功路径”设置 `PYTHONPATH="mini_kimi/src"` 再运行

#### 2) 401 / Invalid Authentication

- **原因**：`MOONSHOT_API_KEY` 未设置或错误
- **解决**：重新设置环境变量并重启终端后再运行

#### 3) `SearchWeb` 提示缺少依赖

- **原因**：未安装 `ddgs`
- **解决**：`pip install ddgs`

---

### 本节小结

- **你完成了什么**：把项目跑起来，并验证了至少一个工具链路
- **你掌握了什么**：运行入口、环境变量、`PYTHONPATH` 的作用与排错优先级
