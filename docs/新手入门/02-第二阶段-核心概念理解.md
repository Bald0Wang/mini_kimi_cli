# 02. 觉醒：思考与行动 (Core Concepts)

> "我思故我在。" —— 笛卡尔
> "知是行之始，行是知之成。" —— 王阳明

什么是智能？不仅是能在脑海中构建宏大的理论，更是能伸出手去触摸世界，改变世界。Mini Kimi 的核心魅力在于它不仅仅是一个聊天机器人（Chatbot），它是一个行动者（Agent）。它拥有了“手”和“眼”，可以上网冲浪，可以读写文件。本节我们将深入理解赋予它这种能力的灵魂——ReAct 模式。

### 知识加油站 ⛽️

#### 1. ReAct 模式 (Reasoning + Acting)
ReAct 是 2023 年 ICLR 会议上提出的一种范式，全称是 "Synergizing Reasoning and Acting in Language Models"。它指出，大模型如果只是“思考”（推理），容易产生幻觉；如果只是“行动”，容易缺乏规划。将两者结合，让模型**一边思考下一步做什么，一边执行动作并观察结果**，能显著提升解决复杂问题的能力。
*   **核心流程**: Thought (思考) -> Action (行动) -> Observation (观察) -> Thought...
*   **参考来源**: [ReAct Project Website](https://react-lm.github.io/)

#### 2. JSON Schema
如何让一个只懂自然语言的模型，能够精确地调用代码中的函数？答案是 JSON Schema。它是一种基于 JSON 的声明性语言，用来描述数据的结构。我们把工具的“说明书”（参数名、类型、描述）写成 JSON Schema 格式喂给模型，模型就能照着说明书生成符合要求的调用指令。
*   **参考阅读**: [Understanding JSON Schema](https://json-schema.org/understanding-json-schema/)

---

### 学习目标

- 用自己的话解释：什么是 **Agent**，什么是 **工具（Tool）**
- 理解 **ReAct**：Reasoning → Acting → Observation 的循环为何有效
- 理解“工具调用”在 OpenAI 兼容接口里的表示方式（schema / tool_calls）

---

### 你需要先知道的 3 个关键词

#### 1) `messages`（对话历史）

- 每条消息都有 `role`：`system | user | assistant | tool`
- Agent 的“记忆”最小实现就是：把历史消息都放进 `messages` 再发给模型

**最小示例（概念）**：

```json
[
  {"role": "system", "content": "你是谁 + 有哪些工具 + 规则"},
  {"role": "user", "content": "用户的问题"},
  {"role": "tool", "tool_call_id": "xxx", "name": "SearchWeb", "content": "工具返回的结果"},
  {"role": "assistant", "content": "基于结果的回答"}
]
```

#### 2) `tools`（模型可调用的能力清单）

- 工具不是魔法：本质是你写好的函数/类
- 模型之所以“会用”，靠的是工具的 **schema 描述**

**schema 的作用**：把“有哪些工具、工具叫什么、需要哪些参数、参数是什么类型”讲清楚，让模型能输出可解析的调用。

#### 3) `tool_calls`（模型返回的结构化工具调用）

- 当模型决定调用工具时，会返回 `tool_calls`
- 每个 `tool_call` 包含：工具名 + JSON 参数字符串

**你可以把它理解为**：模型先“写好一张调用单”，程序再按单执行。

---

### ReAct 为什么能工作（用 Mini Kimi 解释）

ReAct 的关键不是“想得更深”，而是**把不确定性外包给工具**：

- **Reasoning**：模型判断当前缺什么信息/需要执行什么动作
- **Acting**：模型发起一次工具调用（比如搜索、读网页、跑命令）
- **Observation**：工具把真实世界的结果返回，作为下一轮推理的依据

这使得模型不需要“凭空编造”，而是能把答案建立在可验证的输出上。

---

### 关键技术细节（与 Mini Kimi 代码对齐）

#### 1) 工具名必须一致

- 工具 schema 里声明的 `function.name`（例如 `SearchWeb`）
- 必须和 `Soul` 的 `tool_map` 里注册的名字一致

否则模型即使“想调用”，也会出现“找不到工具”的失败路径。

#### 2) 工具参数是 JSON 字符串

在 Mini Kimi 里，工具调用参数会被 `json.loads(...)` 解析，所以：

- 模型输出必须是合法 JSON
- 参数键名必须与 schema 的参数名一致（如 `query`、`url`、`path`、`content`）

---

### 检查点（完成标准）

请口头回答（或写在笔记里）：

1) **为什么工具 schema 能让模型会用工具？**
2) **为什么工具结果要回填到 messages 里，而不是只打印在终端？**
3) **为什么需要最大步数限制？**

---

### 小练习（不改代码也能做）

在 CLI 里输入下面的问题，观察终端里是否出现工具调用：

- `搜索“ddgs python package”并读取一个结果网页的要点`

然后回答：

- 模型调用了哪些工具？
- 工具输出在对话链路里属于哪个 `role`？

---

### 本节小结

- **你理解了什么**：`messages` 是最小记忆，`tools/schema` 是能力说明书，`tool_calls` 是模型给出的“可执行计划”
- **你对齐了哪些工程细节**：工具名一致性、JSON 参数可解析性、最大步数防死循环
