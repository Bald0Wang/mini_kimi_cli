# Mini Kimi CLI 架构说明

## 1. 项目概述

`mini_kimi` 是 Kimi CLI 的一个精简实现，旨在展示 AI Agent 的核心工作原理。通过重构，该项目现在的结构模仿了完整的 `kimi_cli` 项目，采用了模块化和分层设计。

## 2. 目录结构

```text
src/mini_kimi/
├── llm/                # LLM 交互层
│   ├── client.py       # OpenAI 客户端封装
│   └── __init__.py
├── soul/               # 核心逻辑层
│   ├── soul.py         # ReAct 循环与上下文管理
│   └── __init__.py
├── tools/              # 工具层
│   ├── bash/
│   │   └── bash_tool.py
│   ├── file/
│   │   └── write_tool.py
│   └── web/
│       └── search_tool.py
└── ui/                 # 用户界面层
    └── shell/
        └── main.py     # CLI 入口
```

## 3. 模块职责

### 3.1 LLM 层 (`llm/`)
负责与大模型 API 进行通信。
-   **`LLMClient`**: 封装了 `openai` SDK，处理 API Key 的获取（环境变量或配置文件），并将工具 Schema 转换为 API 格式。

### 3.2 工具层 (`tools/`)
定义了 Agent 可使用的各种能力。
-   每个工具都是一个类，包含 `schema`（定义工具描述和参数）和 `__call__`（实际执行逻辑）。
-   **`BashTool`**: 执行 Shell 命令。
-   **`WriteFileTool`**: 写入文件。
-   **`SearchWebTool`**: 使用 DuckDuckGo 进行网页搜索。
-   **`FetchURLTool`**: 获取网页内容。

### 3.3 灵魂层 (`soul/`)
项目的核心“大脑”。
-   **`Soul`**:
    -   维护对话历史 (`messages`)。
    -   注册和管理工具 (`tools`)。
    -   实现 **ReAct 循环**：
        1.  **思考**: 将历史发送给 LLM。
        2.  **行动**: 解析 LLM 返回的 Tool Calls，执行对应工具。
        3.  **观察**: 将工具执行结果回填到历史中。
        4.  **循环**: 重复上述步骤，直到 LLM 返回最终文本或达到最大步数。

### 3.4 UI 层 (`ui/`)
负责与用户的交互。
-   **`shell/main.py`**: 提供一个简单的 REPL (Read-Eval-Print Loop) 界面，接收用户输入并调用 `Soul` 进行处理。

## 4. 运行方式

在 `mini_kimi` 根目录下运行：

```bash
python src/mini_kimi/ui/shell/main.py
```

## 5. 设计理念

-   **模块化**: 不同功能的代码分离，便于维护和扩展。
-   **极简主义**: 不引入复杂的依赖注入框架，保留最核心的逻辑。
-   **兼容性**: 模仿原项目结构，便于开发者理解完整版 Kimi CLI 的设计思路。
